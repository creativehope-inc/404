enchant();var SOUND_NORMAL="./sound/GameNormalBGM_01.ogg| ./sound/GameNormalBGM_01.mp3";var SOUND_START="./sound/GameStartSound_01.ogg| ./sound/GameStartSound_01.mp3";var SOUND_NAGERU="./sound/BlockKuttukiSound_01.ogg| ./sound/BlockKuttukiSound_01.mp3";var SOUND_LIMIT="./sound/GameTimeLimitBGM_01.ogg| ./sound/GameTimeLimitBGM_01.mp3";var SOUND_HAMARU="./sound/BlockNageruSound_01.ogg| ./sound/BlockNageruSound_01.mp3";var SOUND_VANISH="./sound/BlockKieruSound_01.ogg| ./sound/BlockKieruSound_01.mp3";var SOUND_LIMITCOME="./sound/TimeLimitCommingSound_01.ogg| ./sound/TimeLimitCommingSound_01.mp3";var SOUND_OUT="./sound/TimeOutSound_01.ogg| ./sound/TimeOutSound_01.mp3";var SOUND_END="./sound/GameRankingBGM_01.ogg| ./sound/GameRankingBGM_01.mp3";var IMAGE_KAEDE="./img/kaede_merge.png";var IMAGE_BACKGROUND="./img/p_back.png";var IMAGE_BLOCK_PI="./img/p_1merge.png";var IMAGE_BLOCK_CO="./img/p_2merge.png";var IMAGE_BLOCK_MO="./img/p_3merge.png";var IMAGE_BLOCK_NN="./img/p_4merge.png";var IMAGE_NEXT="./img/next_merge.png";var IMAGE_START="./img/pazupico_exp.jpg";var IMAGE_OTH="./img/column_back_fill.png";var IMAGE_SELECT="./img/p_select.png";var IMAGE_MAGIC="./img/p_magic.png";var IMAGE_SCORE="./img/score.png";var IMAGE_GAGE="./img/score_bottom.jpg";var IMAGE_SOUND="./img/sound_merge.png";var IMAGE_5sec="./img/time_5sec.png";var IMAGE_KEY="./img/keyboard_2.png";var ASSETS=[IMAGE_KAEDE,IMAGE_BACKGROUND,IMAGE_BLOCK_PI,IMAGE_BLOCK_CO,IMAGE_BLOCK_MO,IMAGE_BLOCK_NN,IMAGE_NEXT,IMAGE_START,IMAGE_OTH,IMAGE_SELECT,IMAGE_MAGIC,IMAGE_SCORE,IMAGE_GAGE,IMAGE_SOUND,IMAGE_5sec,IMAGE_KEY,];var SCREEN_WIDTH=960;var SCREEN_HEIGHT=600;var BACKGROUND_WIDTH=960;var BACKGROUND_HEIGHT=600;var BACKGROUND_COLOR="#2b3d4f";var GAME_SPEED=5;var GAME_FPS=30;var GAME_TIME_LIMIT=GAME_FPS*120;var global={game:null,sound:null,kaede:null,block:null,score:0,progress:0,keybindFlag:true,soundType:null};global.sound={normal:createjs.Sound.createInstance(SOUND_NORMAL),start:createjs.Sound.createInstance(SOUND_START),nageru:createjs.Sound.createInstance(SOUND_NAGERU),limit:createjs.Sound.createInstance(SOUND_LIMIT),hamaru:createjs.Sound.createInstance(SOUND_HAMARU),vanish:createjs.Sound.createInstance(SOUND_VANISH),limitcome:createjs.Sound.createInstance(SOUND_LIMITCOME),out:createjs.Sound.createInstance(SOUND_OUT),end:createjs.Sound.createInstance(SOUND_END),mute:function(){this.normal.setMute(true);this.start.setMute(true);this.nageru.setMute(true);this.limit.setMute(true);this.hamaru.setMute(true);this.vanish.setMute(true);this.limitcome.setMute(true);this.out.setMute(true);this.end.setMute(true)},unmute:function(){this.normal.setMute(false);this.start.setMute(false);this.nageru.setMute(false);this.limit.setMute(false);this.hamaru.setMute(false);this.vanish.setMute(false);this.limitcome.setMute(false);this.out.setMute(false);this.end.setMute(false)}};window.onload=function(){var queue=new createjs.LoadQueue(true);queue.installPlugin(createjs.Sound);var manifest=[{"src":SOUND_NORMAL,"id":"normal"},{"src":SOUND_START,"id":"start"},{"src":SOUND_NAGERU,"id":"nageru"},{"src":SOUND_LIMIT,"id":"limit"},{"src":SOUND_HAMARU,"id":"hamaru"},{"src":SOUND_VANISH,"id":"vanish"},{"src":SOUND_LIMITCOME,"id":"limitcome"},{"src":SOUND_OUT,"id":"out"},{"src":SOUND_END,"id":"end"}];queue.addEventListener('complete',gameStart);queue.loadManifest(manifest,true);var js=document.createElement('script');js.src='https://www.picomon.jp/game/get_solt.js';var fjs=document.getElementsByTagName('script')[0];fjs.parentNode.insertBefore(js,fjs)};var gameStart=function(){global.game=new Core(SCREEN_WIDTH,SCREEN_HEIGHT);global.game.preload(ASSETS);global.game.fps=GAME_FPS;global.game.onload=function(){global.game.replaceScene(createTitleScene())};var createTitleScene=function(){var scene=new Scene();scene.backgroundColor=BACKGROUND_COLOR;var startimage=new Sprite(SCREEN_WIDTH,SCREEN_HEIGHT);startimage.image=global.game.assets[IMAGE_START];startimage.addEventListener(Event.TOUCH_START,function(e){global.game.replaceScene(createGameScene())});scene.addChild(startimage);var soundS=new Sprite(51,21);soundS.image=global.game.assets[IMAGE_SOUND];soundS.x=15;soundS.y=10;soundS.frame=global.soundType;soundS._style.zIndex=1;soundS.ontouchstart=function(){if(soundS.frame===0){global.sound.unmute();soundS.frame=1}else{global.sound.mute();soundS.frame=0}global.soundType=soundS.frame};scene.addChild(soundS);return scene};global.game.start()};
var createTitleScene=function(){var titleScene=new Scene();titleScene.backgroundColor=BACKGROUND_COLOR;var startimage=new Sprite(SCREEN_WIDTH,SCREEN_HEIGHT);startimage.image=global.game.assets[IMAGE_START];startimage.addEventListener(Event.TOUCH_START,function(e){global.game.replaceScene(createGameScene())});titleScene.addChild(startimage);return titleScene};var createGameOverScene=function(){var gameoverScene=new Scene();gameoverScene.backgroundColor=BACKGROUND_COLOR;global.sound.end.play("none",0,0,-1);var background=new Sprite(BACKGROUND_WIDTH-220,BACKGROUND_HEIGHT);background.image=global.game.assets[IMAGE_BACKGROUND];background.addEventListener(Event.TOUCH_START,function(e){global.game.replaceScene(createTitleScene());global.sound.end.stop()});gameoverScene.addChild(background);var oth=new Sprite(220,540);oth.image=global.game.assets[IMAGE_OTH];oth.x=740;oth.y=0;gameoverScene.addChild(oth);if(global.score>0){$(".score_modal").show();var $picoCount=$('.score_modal .score_body .game_score');$picoCount.val(global.score)}var close_inp=$('.score_modal .close');close_inp.on('click',function(){$(".score_modal").hide()});var inputEntry=$('.score_modal .btn-primary');inputEntry.on('click',function(){$('.score_modal .score_body .error_area').hide();var nickname=$('.score_modal .score_body .Pname').val();if(nickname===''){$('.score_modal .score_body .error_area').show();return false}ranking_comu(global.score,nickname,function(data){if(data.error==1){var inputError=$('.ranking_modal .callback_error');inputError.show();$(".ranking_modal .score_body").hide();$(".ranking_modal .score_footer").hide()}$('.ranking_modal .score_header #rank ').text(data.rank);_.each(data.ranking,function(rnk,i){try{rnk=JSON.parse(rnk)}catch(e){return}$('.ranking_modal .score_body .score_'+i+' .score_point ').text(rnk.score);$('.ranking_modal .score_body .score_'+i+' .name ').text(rnk.nickname)});$(".score_modal").hide();$(".ranking_modal").show()})});var twitterShareButtonElm=$('.ranking_modal .score_footer #twitterShareButton');twitterShareButtonElm.click(function(event){var postMessage=encodeURIComponent('ピコもん 404ゲームで'+global.score+'ピコ消しました！');window.open('https://twitter.com/intent/tweet?hashtags=picomon&original_referer=http%3A%2F%2F404.picomon.jp%2F&text='+postMessage+'&tw_p=tweetbutton&url=http%3A%2F%2F404.picomon.jp%2F&related=picomon_jp',null,'width=400,height=300')});var facebookShareButtonElm=$('.ranking_modal .score_footer #facebookShareButton');facebookShareButtonElm.click(function(event){var facebookShare=function(){window.open('https://www.facebook.com/sharer.php?src=bm&v=4&i=1374645413&u='+encodeURIComponent(location.href)+'&t='+encodeURIComponent('ピコもん 404ゲームで'+global.score+'ピコ消しました！'),'sharer','toolbar=0,status=0,resizable=1,width=626,height=436')};if(/Firefox/.test(navigator.userAgent)){setTimeout(facebookShare,0)}else{facebookShare()}});var close_rnk=$('.ranking_modal .close');close_rnk.on('click',function(){$(".ranking_modal").hide()});var retrylabel=new Label(global.score+"ピコです");retrylabel.textAlign='center';retrylabel.color='black';retrylabel.x=(BACKGROUND_WIDTH-220)/3;retrylabel.y=300;retrylabel.font='20px sans-serif';retrylabel.text="クリックしてタイトルへ";gameoverScene.addChild(retrylabel);function ranking_comu(score,name,callback){window._picomon_savedScore=callback;var solt=(typeof window.__404_picomon_solt__==='function')?__404_picomon_solt__():'';var js=document.createElement('script');js.src='https://www.picomon.jp/game/set_score?data='+Base64.encodeURI(solt+Base64.encodeURI(JSON.stringify({callback:' _picomon_savedScore',type:'puzpico',score:score,nickname:encodeURIComponent(name)})));var fjs=document.getElementsByTagName('script')[0];fjs.parentNode.insertBefore(js,fjs);js.onload=function(){fjs.parentNode.removeChild(js)}}return gameoverScene};
var createGameScene=function(){var self=this;var blocks=[];var selectarea=[];var topBlock=[];var button=[];var kaedeMove=false;var ballMove=false;var label;var ichi;var juu;global.sound.out.setVolume(0.5);global.sound.limitcome.setVolume(0.3);global.sound.limit.setVolume(0.8);var scene=new Scene();scene.backgroundColor=BACKGROUND_COLOR;global.game.keybind(81,"q");global.game.addEventListener("qbuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(126,kaede.y,25);KM({x:126})}});global.game.keybind(87,"w");global.game.addEventListener("wbuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(180,kaede.y,25);KM({x:180})}});global.game.keybind(69,"e");global.game.addEventListener("ebuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(233,kaede.y,25);KM({x:233})}});global.game.keybind(82,"r");global.game.addEventListener("rbuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(289,kaede.y,25);KM({x:289})}});global.game.keybind(84,"t");global.game.addEventListener("tbuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(343,kaede.y,25);KM({x:343})}});global.game.keybind(89,"y");global.game.addEventListener("ybuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(397,kaede.y,25);KM({x:397})}});global.game.keybind(85,"u");global.game.addEventListener("ubuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(452,kaede.y,25);KM({x:452})}});global.game.keybind(73,"i");global.game.addEventListener("ibuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(508,kaede.y,25);KM({x:508})}});global.game.keybind(79,"o");global.game.addEventListener("obuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(564,kaede.y,25);KM({x:564})}});global.game.keybind(80,"p");global.game.addEventListener("pbuttondown",function(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(620,kaede.y,25);KM({x:620})}});global.sound.start.play();global.sound.normal.play("none",0,0,-1);function KM(e){kaedeMove=true;global.keybindFlag=false;if(kaede.x>e.x){kaede.frame=frameList1}else if(kaede.x<e.x){kaede.frame=frameList2}kaede.tl.then(function(){kaede.frame=8;kaede.tl.delay(3).then(function(){kaede.frame=9});global.sound.nageru.play();magicCall();ballMove=true;_.sortBy(blocks,function(block){return block.x+block.y*10})})}var background=new Sprite(BACKGROUND_WIDTH-220,BACKGROUND_HEIGHT);background.image=global.game.assets[IMAGE_BACKGROUND];scene.addChild(background);var oth=new Sprite(220,540);oth.image=global.game.assets[IMAGE_OTH];oth.x=740;oth.y=0;scene.addChild(oth);var soundS=new Sprite(51,21);soundS.image=global.game.assets[IMAGE_SOUND];soundS.x=15;soundS.y=10;soundS.frame=global.soundType;soundS._style.zIndex=1;soundS.ontouchstart=function(){if(soundS.frame===0){global.sound.unmute();soundS.frame=1}else{global.sound.mute();soundS.frame=0}};scene.addChild(soundS);global.score=0;var scoreLabel=new Label("SCORE : 0");scoreLabel.font="16px Tahoma";scoreLabel.color="red";scoreLabel.x=-9999;scene.addChild(scoreLabel);var score1=new Sprite(64,80);score1.image=global.game.assets[IMAGE_SCORE];score1.frame=0;score1.x=BACKGROUND_WIDTH-200+41;score1.y=BACKGROUND_HEIGHT-260;score1.on('enterframe',function(){this.frame=ichi});scene.addChild(score1);var score2=new Sprite(64,80);score2.image=global.game.assets[IMAGE_SCORE];score2.frame=0;score2.x=BACKGROUND_WIDTH-220;score2.y=BACKGROUND_HEIGHT-260;score2.on('enterframe',function(){this.frame=juu});scene.addChild(score2);global.progress=0;global.game.frame=0;var ProgressBar=Class.create(Sprite,{initialize:function(){var barSizeY=Math.floor(global.progress*300)+15;Sprite.call(this,26,barSizeY);var surf=new Surface(100,100);surf.context.beginPath();surf.context.fillStyle='rgba(256, 256, 256, 1.0)';surf.context.fillRect(0,0,26,barSizeY);this.image=surf;this.moveTo(911,103)},onenterframe:function(){var parent=this.parentNode;parent.removeChild(this);parent.addChild(new ProgressBar());scene.removeChild(gage);scene.addChild(gage)}});var progressBar=new ProgressBar();scene.addChild(progressBar);var gage=new Sprite(26,12);gage.image=global.game.assets[IMAGE_GAGE];gage.x=911;gage.y=407;gage._style.zIndex=30;scene.addChild(gage);if(progressBar<0.2){global.sound.normal.stop();global.sound.limit.start()}var kaede=new Kaede();scene.addChild(kaede);function magicCall(){var magic=new Magic();magic.x=kaede.x-40;magic.y=kaede.y+44;scene.addChild(magic);return magic}for(var i=0;i<4;i++){for(var j=0;j<10;j++){var rand=Math.floor(Math.random()*4);switch(rand){case 0:blocks[i*10+j]=new Block_pi(j*(50+3)+(BACKGROUND_WIDTH-220-53*10)/2,i*(50+3));break;case 1:blocks[i*10+j]=new Block_co(j*(50+3)+(BACKGROUND_WIDTH-220-53*10)/2,i*(50+3));break;case 2:blocks[i*10+j]=new Block_mo(j*(50+3)+(BACKGROUND_WIDTH-220-53*10)/2,i*(50+3));break;case 3:blocks[i*10+j]=new Block_nn(j*(50+3)+(BACKGROUND_WIDTH-220-53*10)/2,i*(50+3));break}scene.addChild(blocks[i*10+j])}}function NEXTBLOCK(){var nextb=new NextBlock();var rnd=_.random(3);nextb.frame=　rnd;scene.addChild(nextb);return nextb}function getKaedeBlock(nextb){var kaedeBlock;switch(nextb.frame){case 0:kaedeBlock=new Block_pi();break;case 1:kaedeBlock=new Block_co();break;case 2:kaedeBlock=new Block_mo();break;case 3:kaedeBlock=new Block_nn();break;default:break}kaedeBlock.x=kaede.x-26;kaedeBlock.y=kaede.y+50;kaedeBlock.scale(0.5,0.5);scene.addChild(kaedeBlock);return kaedeBlock}function tuikaBlock(x,y){var tb=new Sprite(50,50);tb=kaedeBlock;tb.x=x;tb.y=y;tb.setTop(blocks);tb.setRight(blocks);tb.setLeft(blocks);if(tb instanceof Block_pi)tb.checkBlock_pi();if(tb instanceof Block_co)tb.checkBlock_co();if(tb instanceof Block_mo)tb.checkBlock_mo();if(tb instanceof Block_nn)tb.checkBlock_nn();scene.addChild(tb);return tb}for(var x=0;x<10;x++){topBlock[x]=new Sprite(50,50);topBlock[x].x=x*(50+3)+(BACKGROUND_WIDTH-220-53*10)/2;topBlock[x].y=0;scene.addChild(topBlock[x])}function SELECTAREA(blocks){function eventCallback(e){if(!kaedeMove&&!ballMove){kaede.tl.moveTo(e.x-(kaede.width/2-50),kaede.y,25);KM(e)}}for(var x=0;x<10;x++){selectarea[x]=new Sprite(42,41);selectarea[x].image=global.game.assets[IMAGE_KEY];selectarea[x].frame=x;selectarea[x].y=BACKGROUND_HEIGHT-50;selectarea[x].x=x*(50+4)+(BACKGROUND_WIDTH-220-53*10)/2;selectarea[x]._style.zIndex=1;selectarea[x].addEventListener(Event.TOUCH_START,eventCallback);scene.addChild(selectarea[x])}return selectarea[x]}var nextb=NEXTBLOCK();var kaedeBlock=getKaedeBlock(nextb);SELECTAREA();scene.addEventListener(Event.ENTER_FRAME,function(e){if(ballMove){kaedeBlock.y=kaedeBlock.y-8;kaedeBlock.tl.scaleTo(1,1,30);if(kaedeBlock.y<-10){ballMove=false}}if(!ballMove){kaedeBlock.x=kaede.x-26;kaedeBlock.y=kaede.y+50}for(var j=0;j<blocks.length;j++){if(kaedeBlock.within(blocks[j],27)){global.sound.hamaru.play();blocks.push(tuikaBlock(blocks[j].x,blocks[j].y+53));ballMove=false;kaede.frame=0;kaedeBlock=getKaedeBlock(nextb);scene.removeChild(nextb);nextb=NEXTBLOCK();kaedeMove=false}if(blocks[j].moveFlag){if(blocks[j].within(blocks[j],50)){blocks[j].moveFlag=false}}if(blocks[j].y>=424&&!vanishFlag){kaede.frame=6;global.sound.limit.stop();global.sound.normal.stop();global.sound.out.play();setTimeout(global.game.replaceScene(createGameOverScene()),6000)}}for(var b=0;b<topBlock.length;b++){if(kaedeBlock.within(topBlock[b],20)){global.sound.hamaru.play();blocks.push(tuikaBlock(topBlock[b].x,0));ballMove=false;kaede.frame=0;kaedeBlock=getKaedeBlock(nextb);scene.removeChild(nextb);nextb=NEXTBLOCK();kaedeMove=false}}_.each(blocks,function(block){if(block.opacity<0){global.sound.vanish.play();scene.removeChild(block);blocks=_.without(blocks,block);global.score=global.score+1/4;scoreLabel.text="SCORE : "+global.score;var timePlus=new TimePlus();scene.addChild(timePlus);GAME_TIME_LIMIT=GAME_TIME_LIMIT+500/4}});vanishFlag=_.chain(blocks).pluck('frame').contains(2).value();_.each(blocks,function(block){if(block.y!==0&&!block.moveFlag&&!getUpBlock(blocks,block)){block.moveFlag=true;checkMoveBlocks(blocks,block)}});_.each(blocks,function(block){if(block.y>0&&block.moveFlag){block.y=block.y-53/4;block.setTop(blocks);block.setRight(blocks);block.setLeft(blocks);if(block instanceof Block_pi)block.checkBlock_pi();if(block instanceof Block_co)block.checkBlock_co();if(block instanceof Block_mo)block.checkBlock_mo();if(block instanceof Block_nn)block.checkBlock_nn()}});ichi=(global.score%10);juu=(global.score%100)/10;global.progress=global.game.frame/GAME_TIME_LIMIT;if(global.progress>1){kaede.frame=6;setTimeout(global.game.replaceScene(createGameOverScene()),1000);global.sound.limit.stop();global.sound.out.play()}if(global.progress==0.8){global.sound.normal.stop();global.sound.limitcome.play();global.sound.limit.play("none",0,0,-1)}});return scene};function checkMoveBlocks(blocks,b){var ub=getUnderBlock(blocks,b);if(ub){ub.moveFlag=true;checkMoveBlocks(blocks,ub)}}function getUnderBlock(blocks,b){return _.find(blocks,function(block){return block.x==b.x&&block.y==b.y+53})}function getUpBlock(blocks,b){return _.find(blocks,function(block){return block.x==b.x&&block.y==b.y-53})};
var KAEDE_WIDTH=95;var KAEDE_HEIGHT=135;var frameList1=[2,2,2,2,3,3,3,3];var frameList2=[4,4,4,4,5,5,5,5];var Kaede=Class.create(Sprite,{initialize:function(){Sprite.call(this,KAEDE_WIDTH,KAEDE_HEIGHT);this.image=global.game.assets[IMAGE_KAEDE];this.x=(BACKGROUND_WIDTH-220-95)/2;this.y=BACKGROUND_HEIGHT-194;this.tX=this.x;this.frameIndex=0}});var TimePlus=Class.create(Sprite,{initialize:function(){Sprite.call(this,79,49);this.image=global.game.assets[IMAGE_5sec];this.x=BACKGROUND_WIDTH-140;this.y=BACKGROUND_HEIGHT-460;this.tl.fadeOut(40);this.tl.and();this.tl.moveBy(0,-20,40);this.tl.removeFromScene()}});
var BLOCK_WIDTH=50;var BLOCK_HEIGHT=50;var BLOCK_FRAME=0;var BlockType=0;var checkBlock=false;var checkBlock2=false;var Block=Class.create(Sprite,{initialize:function(x,y){Sprite.call(this,BLOCK_WIDTH,BLOCK_HEIGHT);this.frame=BLOCK_FRAME;this.x=x;this.y=y;this._style.zIndex=1;this.opacity=1;this.on('enterframe',function(){if(this.frame==2){this.opacity-=0.1}})},setTop:function(blocks){this.top=getBlock(blocks,this.x,this.y-53);this.top2=getBlock(blocks,this.x,this.y-106);this.top3=getBlock(blocks,this.x,this.y-159)},setRight:function(blocks){this.right=getBlock(blocks,this.x+53,this.y);this.right2=getBlock(blocks,this.x+106,this.y);this.right3=getBlock(blocks,this.x+159,this.y)},setLeft:function(blocks){this.left=getBlock(blocks,this.x-53,this.y);this.left2=getBlock(blocks,this.x-106,this.y);this.left3=getBlock(blocks,this.x-159,this.y)}});var Block_pi=Class.create(Block,{initialize:function(x,y){Block.call(this,x,y);this.image=global.game.assets[IMAGE_BLOCK_PI]},checkBlock_pi:function(blocks){if(this.top instanceof Block_co){if(this.top2 instanceof Block_mo){if(this.top3 instanceof Block_nn){checkBlock=true;vanishFlag=true}}}if(this.right instanceof Block_co){if(this.right2 instanceof Block_mo){if(this.right3 instanceof Block_nn){checkBlock2=true;vanishFlag=true}}}if(checkBlock){this.frame=2;this.top.frame=2;this.top2.frame=2;this.top3.frame=2}checkBlock=false;if(checkBlock2){this.frame=2;this.right.frame=2;this.right2.frame=2;this.right3.frame=2}checkBlock2=false}});var Block_co=Class.create(Block,{initialize:function(x,y){Block.call(this,x,y);this.image=global.game.assets[IMAGE_BLOCK_CO]},checkBlock_co:function(blocks){if(this.left instanceof Block_pi){if(this.right instanceof Block_mo){if(this.right2 instanceof Block_nn){checkBlock=true;vanishFlag=true}}}if(checkBlock){this.frame=2;this.left.frame=2;this.right.frame=2;this.right2.frame=2}checkBlock=false}});var Block_mo=Class.create(Block,{initialize:function(x,y){Block.call(this,x,y);this.image=global.game.assets[IMAGE_BLOCK_MO]},checkBlock_mo:function(){if(this.right instanceof Block_nn){if(this.left instanceof Block_co){if(this.left2 instanceof Block_pi){checkBlock=true;vanishFlag=true}}}if(checkBlock){this.frame=2;this.right.frame=2;this.left.frame=2;this.left2.frame=2}checkBlock=false}});var Block_nn=Class.create(Block,{initialize:function(x,y){Block.call(this,x,y);this.image=global.game.assets[IMAGE_BLOCK_NN]},checkBlock_nn:function(blocks){if(this.top instanceof Block_mo){if(this.top2 instanceof Block_co){if(this.top3 instanceof Block_pi){checkBlock=true;vanishFlag=true}}}if(this.left instanceof Block_mo){if(this.left2 instanceof Block_co){if(this.left3 instanceof Block_pi){checkBlock2=true;vanishFlag=true}}}if(checkBlock){this.frame=2;this.top.frame=2;this.top2.frame=2;this.top3.frame=2}checkBlock=false;if(checkBlock2){this.frame=2;this.left.frame=2;this.left2.frame=2;this.left3.frame=2}checkBlock2=false}});var NextBlock=Class.create(Sprite,{initialize:function(x,y){Sprite.call(this,BLOCK_WIDTH,BLOCK_HEIGHT);this.image=global.game.assets[IMAGE_NEXT];this.x=BACKGROUND_WIDTH-200+220/3;this.y=BACKGROUND_HEIGHT-122}});var Magic=Class.create(Sprite,{initialize:function(x,y){Sprite.call(this,55,62);this.image=global.game.assets[IMAGE_MAGIC];this.tl.fadeOut(10)}});function getBlock(blocks,bx,by){return _.find(blocks,function(block){return block.x==bx&&block.y==by})};